<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste Final - Logout Funcionando</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content p {
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: #6c757d;
        }

        .button-secondary:hover {
            background: #5a6268;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        .console {
            background: #1e1e1e;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #667eea;
        }

        .console-line {
            margin-bottom: 5px;
            word-break: break-all;
        }

        .console-error {
            color: #ff6b6b;
        }

        .console-success {
            color: #51cf66;
        }

        .console-info {
            color: #74c0fc;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #004085;
            font-size: 13px;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Final - Logout</h1>
        <p class="subtitle">Validando se o logout redireciona para login.html</p>

        <div class="info-box">
            ‚ö†Ô∏è <strong>IMPORTANTE:</strong> Abra o Console (F12 ‚Üí Console) para ver os logs detalhados durante o teste!
        </div>

        <div class="test-section">
            <h2>üìã Passo 1: Preparar o Teste</h2>
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <p><strong>Limpar dados anteriores</strong></p>
                    <button onclick="limparDados()">üßπ Limpar localStorage</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Passo 2: Registrar Usu√°rio</h2>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <p><strong>Criar usu√°rio de teste</strong></p>
                    <button onclick="registrarUsuarioTeste()">üë§ Registrar: teste@teste.com</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Passo 3: Fazer Login</h2>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <p><strong>Autenticar com o usu√°rio teste</strong></p>
                    <button onclick="fazerLoginTeste()">üîê Login: teste@teste.com</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Passo 4: Verificar Login</h2>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <p><strong>Confirmar que o usu√°rio est√° logado</strong></p>
                    <button onclick="verificarLogin()">‚úÖ Verificar Sess√£o</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üî¥ Passo 5: TESTE CR√çTICO - Fazer Logout</h2>
            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <p><strong style="color: #d32f2f;">CLIQUE AQUI PARA TESTAR O LOGOUT</strong></p>
                    <p style="color: #666; font-size: 12px; margin-top: 5px;">‚úÖ Esperado: Redirecionado para <span class="highlight">login.html</span></p>
                    <button style="background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);" onclick="fazerLogoutTeste()">üöÄ FAZER LOGOUT AGORA</button>
                </div>
            </div>
        </div>

        <div id="status"></div>

        <div class="console" id="console"></div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
            <p style="color: #666; font-size: 12px; text-align: center; margin-bottom: 10px;">
                Se o logout funcionar, voc√™ ser√° redirecionado em alguns segundos
            </p>
        </div>
    </div>

    <script>
        // Carregar autenticacao.js globalmente
        const script = document.createElement('script');
        script.src = 'autenticacao.js';
        document.head.appendChild(script);

        let consoleLines = [];

        function addConsole(mensagem, tipo = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const linha = `[${timestamp}] ${mensagem}`;
            consoleLines.push({ texto: linha, tipo });

            // Manter apenas √∫ltimas 20 linhas
            if (consoleLines.length > 20) {
                consoleLines.shift();
            }

            renderConsole();
        }

        function renderConsole() {
            const consoleDiv = document.getElementById('console');
            consoleDiv.innerHTML = consoleLines.map(linha => 
                `<div class="console-line console-${linha.tipo}">${linha.texto}</div>`
            ).join('');
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function mostrarStatus(mensagem, tipo) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${tipo}">${mensagem}</div>`;
        }

        function limparDados() {
            localStorage.clear();
            addConsole('‚úÖ localStorage limpo completamente', 'success');
            mostrarStatus('‚úÖ Dados limpos com sucesso!', 'success');
        }

        function registrarUsuarioTeste() {
            try {
                addConsole('üîÑ Iniciando registro...', 'info');
                
                // Aguardar autenticacao.js ser carregado
                setTimeout(() => {
                    if (typeof gerenciador === 'undefined') {
                        addConsole('‚ùå Erro: gerenciador n√£o carregado', 'error');
                        return;
                    }

                    const dados = {
                        nome: 'Usu√°rio Teste',
                        email: 'teste@teste.com',
                        senha: '123456'
                    };

                    const resultado = gerenciador.registrarUsuario(dados);
                    
                    if (resultado.sucesso) {
                        addConsole('‚úÖ Usu√°rio registrado: teste@teste.com', 'success');
                        mostrarStatus('‚úÖ Usu√°rio registrado com sucesso!', 'success');
                    } else {
                        addConsole(`‚ùå Erro no registro: ${resultado.erro}`, 'error');
                        mostrarStatus(`‚ùå Erro: ${resultado.erro}`, 'error');
                    }
                }, 100);
            } catch (erro) {
                addConsole(`‚ùå Exce√ß√£o: ${erro.message}`, 'error');
                mostrarStatus('‚ùå Erro ao registrar', 'error');
            }
        }

        function fazerLoginTeste() {
            try {
                addConsole('üîÑ Iniciando login...', 'info');
                
                setTimeout(() => {
                    if (typeof gerenciador === 'undefined') {
                        addConsole('‚ùå Erro: gerenciador n√£o carregado', 'error');
                        return;
                    }

                    const resultado = gerenciador.fazerLogin('teste@teste.com', '123456');
                    
                    if (resultado.sucesso) {
                        addConsole('‚úÖ Login bem-sucedido', 'success');
                        addConsole(`üë§ Usu√°rio: ${resultado.usuario.nome}`, 'success');
                        mostrarStatus(`‚úÖ Login realizado! Bem-vindo, ${resultado.usuario.nome}!`, 'success');
                    } else {
                        addConsole(`‚ùå Erro no login: ${resultado.erro}`, 'error');
                        mostrarStatus(`‚ùå Erro: ${resultado.erro}`, 'error');
                    }
                }, 100);
            } catch (erro) {
                addConsole(`‚ùå Exce√ß√£o: ${erro.message}`, 'error');
                mostrarStatus('‚ùå Erro ao fazer login', 'error');
            }
        }

        function verificarLogin() {
            try {
                addConsole('üîç Verificando sess√£o...', 'info');
                
                const usuarioLogado = localStorage.getItem('quiz_usuario_logado');
                
                if (usuarioLogado) {
                    const usuario = JSON.parse(usuarioLogado);
                    addConsole(`‚úÖ Usu√°rio logado: ${usuario.nome}`, 'success');
                    addConsole(`üìß Email: ${usuario.email}`, 'success');
                    addConsole(`üèÜ Pontos: ${usuario.pontuacao}`, 'success');
                    mostrarStatus(`‚úÖ Sess√£o ativa! Usu√°rio: ${usuario.nome}`, 'success');
                } else {
                    addConsole('‚ùå Nenhum usu√°rio logado', 'error');
                    mostrarStatus('‚ùå Nenhuma sess√£o ativa', 'error');
                }
            } catch (erro) {
                addConsole(`‚ùå Exce√ß√£o: ${erro.message}`, 'error');
            }
        }

        function fazerLogoutTeste() {
            try {
                addConsole('üöÄ INICIANDO LOGOUT...', 'info');
                addConsole('=' .repeat(40), 'info');
                
                // Verificar antes
                const usuarioAntes = localStorage.getItem('quiz_usuario_logado');
                if (usuarioAntes) {
                    const usuario = JSON.parse(usuarioAntes);
                    addConsole(`üë§ Antes do logout: ${usuario.nome}`, 'info');
                } else {
                    addConsole('‚ùå Nenhum usu√°rio para fazer logout', 'error');
                    return;
                }

                mostrarStatus('‚è≥ Processando logout... voc√™ ser√° redirecionado em breve', 'info');

                // Chamar fun√ß√£o de logout
                setTimeout(() => {
                    addConsole('üîÑ Chamando fazerLogout()...', 'info');
                    
                    if (typeof fazerLogout === 'undefined') {
                        addConsole('‚ùå Fun√ß√£o fazerLogout n√£o encontrada!', 'error');
                        return;
                    }

                    // Adicionar interceptor para logout
                    const originalReplace = window.location.replace;
                    window.location.replace = function(url) {
                        addConsole(`üìç Redirecionando para: ${url}`, 'success');
                        originalReplace.call(window.location, url);
                    };

                    fazerLogout();

                    // Se chegou aqui, logout foi iniciado
                    addConsole('‚úÖ Logout iniciado com sucesso!', 'success');
                    
                }, 200);
            } catch (erro) {
                addConsole(`‚ùå Exce√ß√£o: ${erro.message}`, 'error');
                mostrarStatus('‚ùå Erro ao fazer logout', 'error');
            }
        }

        // Log inicial
        addConsole('üß™ Teste de Logout Carregado', 'success');
        addConsole('Clique em "Limpar localStorage" para come√ßar', 'info');
    </script>
</body>
</html>
